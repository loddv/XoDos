name: Android Build e Upload do APK

# Define os gatilhos (triggers)
on:
  # Dispara automaticamente em pushes para o branch 'main'
  push:
    branches:
      - main
  # Permite a execu√ß√£o manual atrav√©s do bot√£o na interface do GitHub
  workflow_dispatch:

jobs:
  build:
    # O executor que ir√° rodar a Action
    runs-on: ubuntu-latest
    
    # Define o ambiente da Action (execu√ß√£o)
    steps:
    
    # 1. Checkout do Reposit√≥rio (actions/checkout@v4)
    - name: ‚¨áÔ∏è Checkout do Reposit√≥rio e Subm√≥dulos
      uses: actions/checkout@v4
      with:
        # A flag 'submodules' garante que os subm√≥dulos sejam inicializados e atualizados
        submodules: true

    # 2. Configurar o JDK e Caching (actions/setup-java@v4)
    # A v4 √© a vers√£o mais moderna e inclui caching otimizado para Gradle
    - name: ‚òï Configurar o JDK 17 e Cache do Gradle
      uses: actions/setup-java@v4
      with:
        java-version: '17' # Vers√£o recomendada para builds Android/Gradle modernos
        distribution: 'temurin'
        # Habilita o cache otimizado para depend√™ncias do Gradle
        cache: 'gradle' 
        
    - name: Set Permission
      shell: bash
      run: chmod +x ./gradlew

    # 3. Executar o syncDebugJarLibs
    - name: üîÑ Sincronizar Bibliotecas (syncDebugJarLibs)
      # O uso do 'sh' √© expl√≠cito para boa pr√°tica, embora seja o padr√£o em ubuntu-latest
      shell: sh
      run: ./gradlew syncDebugJarLibs
      
    # 4. Executar o Build (assembleDebug)
    - name: üèóÔ∏è Construir o APK Debug (assembleDebug)
      shell: sh
      run: ./gradlew assembleDebug

    # 5. Localizar e Fazer o Upload do APK (actions/upload-artifact@v4)
    # A v4 do upload-artifact √© a mais moderna
    - name: ‚¨ÜÔ∏è Upload do APK como Artefato
      uses: actions/upload-artifact@v4
      with:
        # Nome do artefato (como aparecer√° na p√°gina do workflow)
        name: XoDos-APK-Debug
        # Caminho onde o Gradle geralmente coloca o APK de Debug
        # O uso de wildcard ** garante que encontre o arquivo, independente da estrutura exata
        path: '**/*-debug.apk'
        # Configura√ß√£o moderna da v4: se o arquivo n√£o for encontrado, falha o passo (erro)
        if-no-files-found: error 
        # Tempo que o artefato ser√° mantido (7 dias √© o padr√£o comum)
        retention-days: 7
